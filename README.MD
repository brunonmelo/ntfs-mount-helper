# NTFS Mount Helper

Um servi√ßo systemd para Arch Linux que automaticamente detecta e corrige problemas de montagem de discos NTFS ap√≥s a inicializa√ß√£o do sistema.

## üìã Descri√ß√£o

Este projeto resolve um problema comum em sistemas Linux com discos NTFS: ocasionalmente, ap√≥s a inicializa√ß√£o, os discos NTFS n√£o montam automaticamente devido ao estado "dirty" (sujo). O servi√ßo monitora as entradas NTFS no fstab, detecta falhas na montagem e aplica automaticamente as corre√ß√µes necess√°rias usando `ntfsfix`.

## ‚ú® Funcionalidades

- ‚úÖ Detecta automaticamente discos NTFS configurados no `/etc/fstab`
- ‚úÖ Verifica o status de montagem de cada disco NTFS
- ‚úÖ Aplica `ntfsfix -d` em discos com problemas
- ‚úÖ Tenta remontar discos ap√≥s corre√ß√£o
- ‚úÖ Logs detalhados em `/var/log/ntfs-mount-helper.log`
- ‚úÖ Integra√ß√£o com systemd (journalctl)
- ‚úÖ Suporte a dispositivos identificados por UUID ou LABEL
- ‚úÖ Verifica√ß√£o de erros no kernel via `dmesg`

## üõ† Requisitos

- Arch Linux (ou distribui√ß√µes derivadas)
- Pacote `ntfs-3g` (cont√©m `ntfsfix`)
- Pacote `util-linux` (cont√©m `blkid`, `mountpoint`)
- Systemd (j√° inclu√≠do no Arch)

## üìÅ Estrutura do Projeto

```
ntfs-mount-helper/
‚îú‚îÄ‚îÄ bin/
‚îÇ   ‚îî‚îÄ‚îÄ ntfs-mount-helper.sh     # Script principal
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ ntfs-mount-helper.service # Servi√ßo systemd
‚îú‚îÄ‚îÄ install.sh                   # Script de instala√ß√£o
‚îî‚îÄ‚îÄ README.md                    # Este arquivo
```

## üöÄ Instala√ß√£o

1. **Clone ou copie os arquivos do projeto**

2. **Execute o script de instala√ß√£o como root:**
```bash
sudo ./install.sh
```

O script de instala√ß√£o ir√°:
- Instalar as depend√™ncias necess√°rias (`ntfs-3g` e `util-linux`)
- Copiar o script principal para `/usr/local/bin/`
- Configurar o servi√ßo systemd em `/etc/systemd/system/`
- Habilitar e iniciar o servi√ßo

## ‚öôÔ∏è Configura√ß√£o

### Configura√ß√£o do fstab
Certifique-se de que seus discos NTFS est√£o corretamente configurados no `/etc/fstab`. Exemplo:

```bash
# Montagem por UUID (recomendado)
UUID=1234-5678 /mnt/dados ntfs-3g defaults,uid=1000,gid=1000 0 0

# Montagem por dispositivo
/dev/sdb1 /mnt/backup ntfs-3g defaults 0 0

# Montagem por label
LABEL=MeuHD /mnt/hd ntfs-3g defaults 0 0
```

### Op√ß√µes de montagem recomendadas para NTFS:
- `ntfs-3g` (em vez de apenas `ntfs`)
- `uid=1000,gid=1000` (substitua pelos seus IDs de usu√°rio/grupo)
- `windows_names` (para compatibilidade com nomes de arquivos Windows)
- `noatime` (para melhor desempenho)

## üìä Uso

### Comandos do sistema:

```bash
# Verificar status do servi√ßo
sudo systemctl status ntfs-mount-helper

# Ver logs do servi√ßo no journal
sudo journalctl -u ntfs-mount-helper -f

# Ver logs detalhados do script
sudo tail -f /var/log/ntfs-mount-helper.log

# Executar verifica√ß√£o manualmente
sudo /usr/local/bin/ntfs-mount-helper.sh

# Verificar montagens NTFS atuais
mount | grep -i ntfs

# Desabilitar o servi√ßo (se necess√°rio)
sudo systemctl disable ntfs-mount-helper
sudo systemctl stop ntfs-mount-helper
```

### Quando o servi√ßo √© executado:

O servi√ßo √© configurado para executar:
- **Ap√≥s** as tentativas de montagem do systemd (`After=local-fs.target`)
- **Antes** do sistema ficar pronto para o usu√°rio (`Before=multi-user.target`)
- Isto garante que o servi√ßo execute logo ap√≥s as tentativas de montagem do fstab, corrigindo quaisquer falhas antes que o usu√°rio precise acessar os discos.

## üîç Logs e Diagn√≥stico

O servi√ßo gera logs em dois locais:

1. **Log do systemd** (via journalctl):
```bash
sudo journalctl -u ntfs-mount-helper -n 50 --no-pager
```

2. **Log detalhado do script**:
```bash
sudo tail -n 100 /var/log/ntfs-mount-helper.log
```

O log detalhado inclui:
- Timestamp de cada opera√ß√£o
- Status de cada disco NTFS
- Resultado das corre√ß√µes aplicadas
- Erros encontrados no dmesg
- Relat√≥rio final com estat√≠sticas

## üêõ Solu√ß√£o de Problemas

### Problema: Disco n√£o monta mesmo com o servi√ßo
1. Verifique se o disco aparece no fstab:
   ```bash
   grep -i ntfs /etc/fstab
   ```

2. Teste manualmente a montagem:
   ```bash
   sudo mount -a
   ```

3. Execute o script manualmente para ver mensagens detalhadas:
   ```bash
   sudo /usr/local/bin/ntfs-mount-helper.sh
   ```

### Problema: Servi√ßo n√£o inicia
1. Verifique se as depend√™ncias est√£o instaladas:
   ```bash
   which ntfsfix blkid mountpoint
   ```

2. Recarregue as configura√ß√µes do systemd:
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl restart ntfs-mount-helper
   ```

### Problema: Montagem funciona manualmente mas n√£o automaticamente
1. Verifique as permiss√µes do ponto de montagem:
   ```bash
   ls -la /mnt/
   ```

2. Verifique se h√° erros de disco f√≠sico:
   ```bash
   sudo dmesg | grep -i ntfs
   sudo ntfsfix -d /dev/sdXN  # Substitua sdXN pelo seu dispositivo
   ```

## ‚ö†Ô∏è Limita√ß√µes e Considera√ß√µes

1. **Apenas discos NTFS**: O servi√ßo s√≥ lida com sistemas de arquivos NTFS.
2. **Require privil√©gios root**: O servi√ßo executa como root para poder montar discos.
3. **Linux apenas**: Projetado especificamente para sistemas Linux com systemd.
4. **Discos externos**: Para discos USB/externos, certifique-se de que estejam conectados durante a inicializa√ß√£o.

## üîÑ Reinstala√ß√£o/Remo√ß√£o

Para reinstalar:
```bash
sudo ./install.sh
```

Para remover completamente:
```bash
# Parar e desabilitar o servi√ßo
sudo systemctl stop ntfs-mount-helper
sudo systemctl disable ntfs-mount-helper

# Remover os arquivos
sudo rm /usr/local/bin/ntfs-mount-helper.sh
sudo rm /etc/systemd/system/ntfs-mount-helper.service
sudo rm /var/log/ntfs-mount-helper.log 2>/dev/null

# Recarregar systemd
sudo systemctl daemon-reload
```

## ü§ù Contribui√ß√£o

Contribui√ß√µes s√£o bem-vindas! Sinta-se √† vontade para:
1. Reportar problemas (issues)
2. Sugerir melhorias
3. Enviar pull requests

## üìÑ Licen√ßa

Este projeto √© distribu√≠do sob a licen√ßa MIT. Veja o arquivo LICENSE para mais detalhes.

## üôè Agradecimentos

- Desenvolvedores do `ntfs-3g` pela excelente suporte a NTFS no Linux
- Comunidade Arch Linux pela documenta√ß√£o e suporte
- Systemd por fornecer um sistema de init robusto e flex√≠vel

---

**Nota**: Este servi√ßo √© particularmente √∫til para usu√°rios dual-boot (Windows + Linux) que frequentemente encontram problemas com o estado "dirty" dos discos NTFS ap√≥s desligamento inadequado do Windows.